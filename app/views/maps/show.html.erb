<h1>showファイル</h1>
<div><%= @map.name%></div>
<%= image_tag "island_#{@map.id}.png", class: "island_image"%>

<button id="openModal">投稿</button>

 <%= render partial: 'shared/error_messages', locals: {model: @post}%>

<section id="modalArea" class="modalArea">
  <div id="modalBg" class="modalBg"></div>
  <div class="modalWrapper">
    <div class="modalContents">
      <h1 class="post_title">自分の旅路を投稿しよう!</h1>
      <%= form_with(model: [@map, @post],url: map_posts_path(@map,@post), class: "post_form", method: :post, local: true) do |form| %>
        <%= form.text_area :content, placeholder: "投稿する", class: "post_textbox" %>
        <div class="island_evaluation">
          <p class="good_evaluation">島の総合評価</p>
          <%= form.collection_select(:evaluation_id, Evaluation.all, :id, :name, {}, {class: "evaluation-select"})%>
        </div>
        <div class="island_paste">
          <p class="island_paste_title">画像投稿</p>
          <%= form.file_field :images, name: 'post[images][]', id: 'post_image', class: 'post_image' %>
        </div>
        <div id="image-list"></div>
        <%= form.submit "SEND", class: "submit" %>
      <% end %>

    </div>
    <div id="closeModal" class="closeModal">
      ×
    </div>
  </div>
</section>

  <div class="posts">
    <h4>＜投稿一覧＞</h4>
      <% if @posts %>
        <% @posts.each do |post| %>
          <div class="post_content">
            <p><%= post.user.name%></p>
            <p><%= l post.created_at%></p>
            <p><%= safe_join(post.content.split("\n"), tag(:br)) %></p>
            <p><%= post.evaluation.name%></p>
            <div class="post_images">
              <% post.images.each do |image| %>
              <%= image_tag image, class:'images' %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
  </div>

  <div class="container">
      <%= form_with(model: [@map, @comment], url: map_comments_path(@map), method: :post, local: true) do |form| %>
        <%= form.text_area :content, placeholder: "投稿する", rows: "5" %>
        <%= form.submit "SEND", id: "comment_submit" %>
      <% end %>
  </div>

    <div class="comments">
    <h4>＜コメント欄＞</h4>
    <div class="comments_list" id="comments_list">
      <% if @comments %>
        <% @comments.each do |comment| %>
          <div class="comment">
            <div><%= comment.user.name%></div>
            <div><%= l comment.created_at%></div>
            <div><%= comment.content %></div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>

<script>
  (function () {
  const modalArea = document.getElementById('modalArea');
  const openModal = document.getElementById('openModal');
  const closeModal = document.getElementById('closeModal');
  const modalBg = document.getElementById('modalBg');
  const toggle = [openModal,closeModal,modalBg];
  
  for(let i=0, len=toggle.length ; i<len ; i++){
    toggle[i].addEventListener('click',function(){
      modalArea.classList.toggle('is-show');
    });
  }
}());
</script>
